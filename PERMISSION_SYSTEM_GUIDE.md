# ุฏููู ูุธุงู ุงูุตูุงุญูุงุช ุงููุชูุงูู - Moshrif Web

## โ **ุชู ุชุทุจูู ูุธุงู ุงูุตูุงุญูุงุช ุจุงููุงูู!**

### ๐ฏ **ูุธุฑุฉ ุนุงูุฉ**

ุชู ุชุทุจูู ูุธุงู ุตูุงุญูุงุช ูุชูุงูู ูุญุงูู ุจุฏูุฉ ูุธุงู ุงูุตูุงุญูุงุช ูู ุงูุชุทุจูู ุงูุฃุตููุ ูุน ุฏุนู ูุงูู ูุฌููุน ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช ุงููุฎุชููุฉ.

---

## ๐๏ธ **ูููู ุงููุธุงู**

### **1. ุฃููุงุน ุงูุจูุงูุงุช (`/src/types/permissions.ts`)**

```typescript
// ุฃุฏูุงุฑ ุงููุณุชุฎุฏููู
type UserRole = 'Admin' | 'ูุฏูุฑ ุนุงู' | 'ูุฏูุฑ ุงููุฑุน' | 'ูุงููุฉ' | 'ููุธู';

// ุฃููุงุน ุงูุตูุงุญูุงุช (ูุทุงุจูุฉ ููุชุทุจูู ุงูุฃุตูู)
type PermissionType = 
  | 'ุงููุงู ุงููุฑุญูุฉ'
  | 'ุงุถุงูุฉ ูุฑุญูุฉ ูุฑุนูุฉ'
  | 'ุฅุถุงูุฉ ูุฑุญูุฉ ุฑุฆูุณูุฉ'
  | 'ุชุนุฏูู ูุฑุญูุฉ ุฑุฆูุณูุฉ'
  | 'ุชุดููู ุงูุงูุฌุงุฒุงุช ุงููุฑุนูุฉ'
  | 'ุฅุถุงูุฉ ุชุฃุฎูุฑุงุช'
  | 'ุงูุดุงุก ูุฌูุฏ ุงู ุชุนุฏููู'
  | 'ุงูุดุงุก ุนูููุงุช ูุงููุฉ'
  | 'ุชุฑุชูุจ ุงููุฑุงุญู'
  | 'ุฅูุดุงุก ุทูุจุงุช'
  | 'ุชุดููู ุงูุทูุจุงุช'
  | 'ุฅุดุนุงุฑุงุช ุงููุงููุฉ'
  | 'Admin';
```

### **2. Redux State (`/src/store/slices/userSlice.ts`)**

```typescript
interface UserState {
  user: User | null;
  isAuthenticated: boolean;
  Validity: PermissionType[];  // ูุตูููุฉ ุตูุงุญูุงุช ุงููุณุชุฎุฏู
  boss: BossType;              // ุญุงูุฉ ูุฏูุฑ ุงููุฑุน
}
```

---

## ๐ง **ุงูููููุงุช ุงูุฃุณุงุณูุฉ**

### **1. useValidityUser Hook (`/src/hooks/useValidityUser.ts`)**

```typescript
const { 
  Uservalidation,        // ุงูุชุญูู ูู ุงูุตูุงุญูุฉ (async)
  hasPermission,         // ูุญุต ุณุฑูุน ููุตูุงุญูุฉ (sync)
  isAdmin,              // ูู ุงููุณุชุฎุฏู Admin
  isBranchManager,      // ูู ุงููุณุชุฎุฏู ูุฏูุฑ ูุฑุน
  isFinance,            // ูู ุงููุณุชุฎุฏู ูุงููุฉ
  isEmployee,           // ูู ุงููุณุชุฎุฏู ููุธู
  getUserRole,          // ุงูุญุตูู ุนูู ุฏูุฑ ุงููุณุชุฎุฏู
  getUserPermissions    // ุงูุญุตูู ุนูู ุฌููุน ุตูุงุญูุงุช ุงููุณุชุฎุฏู
} = useValidityUser();
```

### **2. PermissionGuard Component (`/src/components/auth/PermissionGuard.tsx`)**

```typescript
// ุญูุงูุฉ ุนุงูุฉ ุจุตูุงุญูุฉ ูุงุญุฏุฉ
<PermissionGuard permission="Admin">
  <ButtonCreat text="ุฅูุดุงุก ูุฑุน" />
</PermissionGuard>

// ุญูุงูุฉ ุจุตูุงุญูุงุช ูุชุนุฏุฏุฉ
<PermissionGuard 
  permissions={['Admin', 'ุงูุดุงุก ุนูููุงุช ูุงููุฉ']}
  requireAll={false}  // ูุญุชุงุฌ ุฃู ุตูุงุญูุฉ ูู ุงููุงุฆูุฉ
>
  <ButtonCreat text="ุงูุนูุฏ" />
</PermissionGuard>

// ุญูุงูุฉ Admin ููุท
<AdminGuard>
  <ButtonCreat text="ุงูุฃุนุถุงุก" />
</AdminGuard>

// ููุน ุงูููุธููู
<EmployeeRestricted>
  <ButtonCreat text="ุงูุนูุฏ" />
</EmployeeRestricted>
```

### **3. Permission API Hook (`/src/hooks/usePermissionAPI.ts`)**

```typescript
const { 
  fetchUserPermissions,     // ุฌูุจ ุตูุงุญูุงุช ุงููุณุชุฎุฏู
  fetchBranchPermissions,   // ุฌูุจ ุตูุงุญูุงุช ุงููุฑุน
  refreshPermissions,       // ุชุญุฏูุซ ุงูุตูุงุญูุงุช
  clearPermissions         // ูุณุญ ุงูุตูุงุญูุงุช
} = usePermissionAPI();
```

---

## ๐จ **ููููุงุช ุงููุงุฌูุฉ**

### **1. PermissionList Component**

```typescript
<PermissionList
  selectedPermissions={permissions}
  onPermissionChange={setPermissions}
  readonly={false}
  title="ุตูุงุญูุงุช ุงููุณุชุฎุฏู"
/>
```

### **2. PermissionSummary Component**

```typescript
<PermissionSummary />  // ุนุฑุถ ูุฎุชุตุฑ ูุตูุงุญูุงุช ุงููุณุชุฎุฏู ุงูุญุงูู
```

---

## ๐ **ููุทู ุงูุตูุงุญูุงุช**

### **ููุงุนุฏ ุงูุตูุงุญูุงุช (ูุทุงุจูุฉ ููุชุทุจูู ุงูุฃุตูู):**

#### **1. Admin:**
- โ **ุตูุงุญูุฉ ูุงููุฉ**: ููููู ุงููุตูู ูุฌููุน ุงูููุฒุงุช
- โ **ุชุฌุงูุฒ ุฌููุน ุงููููุฏ**: ูุง ูุญุชุงุฌ ูุญุต ุตูุงุญูุงุช ุฅุถุงููุฉ
- โ **ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู**: ููููู ุชุนุฏูู ุตูุงุญูุงุช ุงูุขุฎุฑูู

#### **2. ูุฏูุฑ ุงููุฑุน (`boss === 'ูุฏูุฑ ุงููุฑุน'`):**
- โ **ุตูุงุญูุฉ ุดุจู ูุงููุฉ**: ููููู ุงููุตูู ูุฌููุน ุงูููุฒุงุช ูุง ุนุฏุง Admin
- โ **ุฅุฏุงุฑุฉ ุงููุฑุน**: ุตูุงุญูุงุช ูุงููุฉ ุฏุงุฎู ุงููุฑุน
- โ **ูุง ููููู**: ุชุนุฏูู ุตูุงุญูุงุช ุงููุณุชุฎุฏููู

#### **3. ุงููุณุชุฎุฏููู ุงูุนุงุฏููู:**
- ๐ **ูุญุต ูุตูููุฉ ุงูุตูุงุญูุงุช**: `Validity.includes(permission)`
- โ **ุตูุงุญูุงุช ูุญุฏุฏุฉ**: ุญุณุจ ูุง ูู ููุฌูุฏ ูู `Validity`
- โ **ูููุฏ**: ูุง ูููู ุงููุตูู ููููุฒุงุช ุบูุฑ ุงููุตุฑุญ ุจูุง

### **ููุฏ ููุทู ุงูุชุญูู:**

```typescript
const KnowValidity = (kind: PermissionType, users = user): Promise<boolean> => {
  return new Promise(async (resolve, reject) => {
    try {
      // ุฅุฐุง ูุงู ุงููุณุชุฎุฏู Adminุ ุงูุณูุงุญ ููุฑุงู
      if (users?.data?.job === 'Admin') {
        return resolve(true);
      }
      
      // ุฅุฐุง ูุงู ูุฏูุฑ ูุฑุน ูููุณ ุทูุจ Adminุ ุงูุณูุงุญ
      if (boss === 'ูุฏูุฑ ุงููุฑุน' && kind !== 'Admin') {
        return resolve(true);
      } else {
        // ูุญุต ูุฌูุฏ ุงูุตูุงุญูุฉ ูู ูุตูููุฉ ุงูุตูุงุญูุงุช
        return Array.isArray(Validity) 
          ? resolve(Validity.includes(kind)) 
          : resolve(false);
      }
    } catch (error) {
      reject(error);
    }
  });
};
```

---

## ๐ **ุงูุตูุญุงุช ุงููุทุจูุฉ**

### **1. ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (`/home`)**
- โ **ุนุฑุถ ุตูุงุญูุงุช ุงููุณุชุฎุฏู**: `PermissionSummary`
- โ **ุฃุฒุฑุงุฑ ูุญููุฉ**: ุฅูุดุงุก ูุฑุนุ ุงูุฃุนุถุงุกุ ุงูุนูุฏุ ุงูุตูุงุญูุงุช
- โ **ูุญุต ุงูุตูุงุญูุงุช**: ูุจู ุนุฑุถ ูู ุฒุฑ

### **2. ุตูุญุฉ ุงูุฃุนุถุงุก (`/members`)**
- โ **ุญูุงูุฉ ุงููุตูู**: Admin ููุท ููููู ุฅุฏุงุฑุฉ ุงูุฃุนุถุงุก
- โ **ูุญุต ุตูุงุญูุงุช ุงูุชุนุฏูู**: ูุจู ุชุนุฏูู ุฃู ูุณุชุฎุฏู
- โ **ูุธุงู ุตูุงุญูุงุช ูุชุฏุฑุฌ**: ุญุณุจ ุฏูุฑ ุงููุณุชุฎุฏู

### **3. ุตูุญุฉ ุฅูุดุงุก ุงููุฑุน (`/create-branch`)**
- โ **ุญูุงูุฉ ุดุงููุฉ**: Admin ููุท ููููู ุฅูุดุงุก ูุฑูุน
- โ **ูุญุต ุงูุตูุงุญูุงุช**: ูู ุฌููุน ุงูุนูููุงุช

### **4. ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช (`/permissions`)** - ุฌุฏูุฏุฉ
- โ **Admin ููุท**: ุตูุญุฉ ูุฎุตุตุฉ ูููุฏูุฑูู
- โ **ุฅุฏุงุฑุฉ ุตูุงุญูุงุช ุงููุณุชุฎุฏููู**: ุชุนุฏูู ูุญูุธ
- โ **ุนุฑุถ ูุฑุฆู ููุตูุงุญูุงุช**: ูุงุฆูุฉ ุชูุงุนููุฉ
- โ **ูุญุต ุตูุงุญูุงุช ุงูุชุนุฏูู**: ูุจู ุชุนุฏูู ุฃู ูุณุชุฎุฏู

---

## ๐ **ุชุฏูู ุงูุจูุงูุงุช**

### **1. ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:**
```
1. ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู โ ุชุฎุฒูู ุจูุงูุงุช ุงููุณุชุฎุฏู
2. usePermissionAPI ูุฌูุจ ุงูุตูุงุญูุงุช ูู API
3. ุชุฎุฒูู ุงูุตูุงุญูุงุช ูู Redux (Validity, boss)
4. ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู ุญุณุจ ุงูุตูุงุญูุงุช
```

### **2. ุนูุฏ ูุญุต ุงูุตูุงุญูุงุช:**
```
1. useValidityUser ููุฑุฃ ูู Redux
2. ุชุทุจูู ููุทู ุงููุญุต (Admin โ ูุฏูุฑ ูุฑุน โ Validity)
3. ุฅุฑุฌุงุน ุงููุชูุฌุฉ (true/false)
4. ุนุฑุถ/ุฅุฎูุงุก ุงููุญุชูู ุญุณุจ ุงููุชูุฌุฉ
```

### **3. ุนูุฏ ุชุญุฏูุซ ุงูุตูุงุญูุงุช:**
```
1. API call ูุชุญุฏูุซ ุตูุงุญูุงุช ุงููุณุชุฎุฏู
2. ุชุญุฏูุซ Redux state
3. ุฅุนุงุฏุฉ ุนุฑุถ ุงููุงุฌูุฉ ุชููุงุฆูุงู
4. ุชุญุฏูุซ ุงูุตูุงุญูุงุช ูู ุฌููุน ุงูููููุงุช
```

---

## ๐ฑ **ุงูุชุทุจูู ุนูู ุงูุตูุญุงุช**

### **ูุซุงู: ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ**

```typescript
// ุงุณุชูุฑุงุฏ ูุธุงู ุงูุตูุงุญูุงุช
import useValidityUser from '@/hooks/useValidityUser';
import PermissionGuard, { AdminGuard } from '@/components/auth/PermissionGuard';
import { PermissionSummary } from '@/components/permissions/PermissionList';

export default function HomePage() {
  const { isAdmin, hasPermission } = useValidityUser();

  return (
    <div>
      {/* ุนุฑุถ ุตูุงุญูุงุช ุงููุณุชุฎุฏู */}
      <PermissionSummary />
      
      {/* ุฃุฒุฑุงุฑ ูุญููุฉ */}
      <AdminGuard>
        <ButtonCreat text="ุฅูุดุงุก ูุฑุน" onpress={handleCreateBranch} />
      </AdminGuard>
      
      <PermissionGuard 
        permissions={['Admin', 'ุงูุดุงุก ุนูููุงุช ูุงููุฉ']}
        requireAll={false}
      >
        <ButtonCreat text="ุงูุนูุฏ" onpress={handleCovenant} />
      </PermissionGuard>
    </div>
  );
}
```

---

## ๐ฏ **ุงููููุฒุงุช ุงููุญููุฉ**

### โ **ูุทุงุจูุฉ ูุงููุฉ ููุชุทุจูู ุงูุฃุตูู:**
- ููุณ ููุทู ุงููุญุต (`ValidityUser.tsx`)
- ููุณ ุฃููุงุน ุงูุตูุงุญูุงุช (`AddValidity.tsx`)
- ููุณ ูููู ุงูุจูุงูุงุช (Redux state)
- ููุณ ุณููู API calls

### โ **ูุธุงู ูุชูุงูู:**
- Hook ูููุญุต (`useValidityUser`)
- Hook ูุฌูุจ ุงูุจูุงูุงุช (`usePermissionAPI`)
- ููููุงุช ุญูุงูุฉ (`PermissionGuard`)
- ููููุงุช ุนุฑุถ (`PermissionList`)
- ุตูุญุฉ ุฅุฏุงุฑุฉ (`/permissions`)

### โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ:**
- ุนุฑุถ ูุฑุฆู ููุตูุงุญูุงุช
- ุฑุณุงุฆู ูุงุถุญุฉ ุนูุฏ ููุน ุงููุตูู
- ุชุญุฏูุซ ุชููุงุฆู ูููุงุฌูุฉ
- ุชุตููู ูุชุฌุงูุจ ููุชูุงุณู

### โ **ุฃูุงู ุดุงูู:**
- ูุญุต ุงูุตูุงุญูุงุช ูู ุงููุงุฌูุฉ
- ูุญุต ุงูุตูุงุญูุงุช ูุจู API calls
- ููุน ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู
- ุฑุณุงุฆู ุชุญุฐูุฑูุฉ ูุงุถุญุฉ

---

## ๐ **ููููุฉ ุงูุงุณุชุฎุฏุงู**

### **1. ูุญุต ุตูุงุญูุฉ ุจุณูุท:**
```typescript
const { hasPermission } = useValidityUser();

if (hasPermission('ุฅูุดุงุก ุทูุจุงุช')) {
  // ุนุฑุถ ุฒุฑ ุฅูุดุงุก ุทูุจ
}
```

### **2. ูุญุต ุตูุงุญูุฉ ูุชูุฏู:**
```typescript
const { Uservalidation } = useValidityUser();

const handleAction = async () => {
  const hasAccess = await Uservalidation('Admin', userId);
  if (hasAccess) {
    // ุชูููุฐ ุงูุนูููุฉ
  }
  // ุฑุณุงูุฉ ุงูุฎุทุฃ ุชุธูุฑ ุชููุงุฆูุงู
};
```

### **3. ุญูุงูุฉ ูููู:**
```typescript
<PermissionGuard permission="ุชุดููู ุงูุทูุจุงุช">
  <RequestsComponent />
</PermissionGuard>
```

### **4. ุญูุงูุฉ ูุชุนุฏุฏุฉ ุงูุตูุงุญูุงุช:**
```typescript
<PermissionGuard 
  permissions={['Admin', 'ูุฏูุฑ ุงููุฑุน', 'ุงูุดุงุก ุนูููุงุช ูุงููุฉ']}
  requireAll={false}
  showError={true}
>
  <FinancialOperationsComponent />
</PermissionGuard>
```

---

## ๐ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ**

โ **ูุธุงู ุตูุงุญูุงุช ูุชูุงูู ููุทุงุจู ุจุงููุงูู ููุชุทุจูู ุงูุฃุตูู**

โ **ูู ูุณุชุฎุฏู ูุฑู ููุท ูุง ูุญู ูู ุงููุตูู ุฅููู**

โ **ูุงุฌูุฉ ูุณุชุฎุฏู ุชุชููู ุชููุงุฆูุงู ุญุณุจ ุงูุตูุงุญูุงุช**

โ **ุฃูุงู ุดุงูู ูู ุฌููุน ูุณุชููุงุช ุงูุชุทุจูู**

โ **ุณูููุฉ ุงูุตูุงูุฉ ูุงูุชุทููุฑ ุงููุณุชูุจูู**

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ููุนูู ุจููุณ ุขููุฉ ุงูุชุทุจูู ุงูุฃุตูู ุชูุงูุงู! ๐**
